import{j as e,b as U,r as c,H as M,a as j}from"./app-F9mGVywk.js";import{N as P}from"./NavBar-BRLkNves.js";import{a as r,s as o}from"./DeleteModal.module-BRf8I1mm.js";import"./Container-Cdm_3uio.js";const S=({userNmae:a,onConfirm:l,onClose:i})=>e.jsx("div",{className:r.modalOverlay,children:e.jsxs("div",{className:r.redModal,children:[e.jsxs("div",{className:r.modalHeader,children:[e.jsx("h3",{children:"Delete User"}),e.jsx("button",{className:`${r.closeBtn} fs-2`,onClick:i,children:"×"})]}),e.jsx("div",{className:r.modalBody,children:e.jsxs("p",{children:['Are you sure you want to delete "',e.jsx("strong",{children:a}),'"?']})}),e.jsxs("div",{className:r.modalFooter,children:[e.jsx("button",{className:"btn btn-danger",onClick:l,children:"Delete"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:i,children:"Cancel"})]})]})}),k=({editData:a,editErrors:l,onChange:i,onSubmit:m,onClose:h})=>e.jsx("div",{className:o.modalOverlay,children:e.jsxs("div",{className:o.editModal,children:[e.jsxs("div",{className:o.modalHeader,children:[e.jsx("h3",{children:"Edit User"}),e.jsx("button",{className:`${o.closeBtn} fs-2`,onClick:h,children:"×"})]}),e.jsxs("div",{className:o.modalBody,children:[e.jsx("label",{children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:n=>i("name",n.target.value),className:l.full_name?"is-invalid":""}),l.full_name&&e.jsx("div",{className:"invalid-feedback",children:l.full_name}),e.jsx("label",{children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:n=>i("email",n.target.value),className:l.email?"is-invalid":""}),l.email&&e.jsx("div",{className:"invalid-feedback",children:l.email}),e.jsx("label",{children:"Phone"}),e.jsx("input",{type:"tel",value:a.phone,maxLength:11,onChange:n=>i("phone",n.target.value),className:l.mobile?"is-invalid":""}),l.mobile&&e.jsx("div",{className:"invalid-feedback",children:l.mobile}),e.jsx("label",{children:"Role"}),e.jsxs("select",{value:a.user_type,onChange:n=>i("user_type",n.target.value),className:l.user_type?"is-invalid":"",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"manager",children:"Manager"})]}),l.user_type&&e.jsx("div",{className:"invalid-feedback",children:l.user_type}),e.jsx("label",{children:"Family Code"}),e.jsx("input",{type:"text",value:a.osra_code||"",onChange:n=>i("osra_code",n.target.value),className:l.osra_code?"is-invalid":""}),l.osra_code&&e.jsx("div",{className:"invalid-feedback",children:l.osra_code}),e.jsxs("div",{className:o.fileUpload,children:[e.jsxs("label",{className:o.uploadBtn,children:["Upload Photo",e.jsx("input",{type:"file",hidden:!0,onChange:n=>i("profilePhoto",n.target.files[0])})]}),a.profilePhoto&&e.jsx("span",{className:o.fileName,children:a.profilePhoto.name})]}),a.profilePhoto&&e.jsx("img",{src:URL.createObjectURL(a.profilePhoto),className:"rounded mt-2",width:"80"})]}),e.jsxs("div",{className:o.modalFooter,children:[e.jsx("button",{className:"btn btn-primary",onClick:m,children:"Save Changes"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:h,children:"Cancel"})]})]})}),F=()=>{const{users:a,osras:l}=U().props,[i,m]=c.useState(!1),[h,n]=c.useState(null),[f,x]=c.useState(!1),[u,p]=c.useState(null),[d,b]=c.useState({name:"",email:"",phone:"",user_type:"user",osra_id:"",profilePhoto:null}),[N,v]=c.useState({}),g=s=>{p(s),x(!0)},y=()=>{u&&j.delete(route("users.destroy",u.user_id),{onSuccess:()=>{x(!1),p(null)},onError:s=>{console.error(s),x(!1),p(null)},preserveScroll:!0})},_=s=>{n(s),b({name:s.full_name,email:s.email,phone:s.mobile,user_type:s.user_type||"user",osra_id:s.osra?.osra_id||"",profilePhoto:null}),v({}),m(!0)},w=s=>{s.preventDefault();const t=new FormData;t.append("_method","PUT"),t.append("full_name",d.name||""),t.append("email",d.email||""),t.append("mobile",d.phone||""),t.append("user_type",d.user_type||""),t.append("osra_code",d.osra_code||""),d.profilePhoto&&t.append("profilePhoto",d.profilePhoto),j.post(route("users.update",h.user_id),t,{forceFormData:!0,onError:C=>v(C),onSuccess:()=>m(!1)})};return e.jsxs("div",{className:"bg-light min-vh-100",children:[e.jsx(M,{title:"مركز وسائل الإيضاح"}),e.jsx(P,{page_name:"users"}),e.jsxs("div",{className:"container py-5",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h2",{className:"fw-bold mb-1",children:"Users Management"}),e.jsx("small",{className:"text-muted",children:"Manage all registered users"})]}),e.jsx("button",{className:"btn btn-success px-4",onClick:()=>j.visit(route("register")),children:"Add User"})]}),e.jsx("div",{className:"card shadow-sm border-0",children:e.jsx("div",{className:"card-body p-0",children:a.length?e.jsx("div",{className:"users-table-container",children:e.jsxs("table",{className:"table table-hover align-middle mb-0 users-table",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"User"}),e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Mobile"}),e.jsx("th",{children:"Email"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:a.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:t+1}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[s.user_photo?e.jsx("img",{src:s.user_photo,alt:s.full_name,className:"user-avatar rounded-circle border"}):e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"currentColor",className:"user-avatar-icon bi bi-person-circle",viewBox:"0 0 16 16",children:[e.jsx("path",{d:"M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"}),e.jsx("path",{fillRule:"evenodd",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"})]}),e.jsx("span",{className:"fw-semibold",children:s.full_name})]})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:s.user_type})}),e.jsx("td",{children:s.mobile}),e.jsx("td",{children:s.email}),e.jsx("td",{className:"text-center user-actions",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2 action-buttons flex-wrap",children:[e.jsx("button",{className:"btn btn-sm btn-primary px-2",onClick:()=>_(s),children:"Edit"}),e.jsx("button",{className:"btn btn-sm btn-danger px-2",onClick:()=>g(s),children:"Delete"})]})})]},s.user_id))})]})}):e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-people display-4 text-muted"}),e.jsx("p",{className:"mt-3 text-muted fw-semibold",children:"No users found"})]})})})]}),i&&e.jsx(k,{editData:{...d,osras:l},editErrors:N,onChange:(s,t)=>b({...d,[s]:t}),onSubmit:w,onClose:()=>m(!1)}),f&&u&&e.jsx(S,{userNmae:u.full_name,onConfirm:y,onClose:()=>x(!1)})]})};export{F as default};

import{b as k,r as a,j as e,L as A,a as y,H as P}from"./app-F9mGVywk.js";import{T as q}from"./TopAlert-B9UA6XVE.js";import{n as z}from"./index-DVAfsfYP.js";import{C as B}from"./Container-Cdm_3uio.js";import{N as F}from"./NavBar-BRLkNves.js";import{s as j}from"./AddModal.module-DtOpv7EN.js";import{E as T,D as H}from"./DeleteItemModal-IYLP5zNS.js";import"./DeleteModal.module-BRf8I1mm.js";const L=({id:l,title:c,brand:x,description:h,image:o,price:b,color_id:i,color:u,size_id:d,size:t,onEdit:n,onDelete:p,children:r})=>{const{auth:v,flash:f,cartItems:N=[]}=k().props||{},C=v?.user,w=C?.user_type==="manager",[S,s]=a.useState(""),[I,_]=a.useState(!1),[g,M]=a.useState(1);a.useEffect(()=>{N?.includes(l)&&_(!0)},[N,l]),a.useEffect(()=>{f?.success&&s(f.success)},[f]);const E=m=>{m.stopPropagation(),y.post(route("cart.add"),{product_id:l,color_id:i||null,size_id:d||null,quantity:g},{preserveScroll:!0,onSuccess:()=>{_(!0),s(`"${c}" added to cart!`),setTimeout(()=>s(""),3e3)}})};return e.jsxs(e.Fragment,{children:[e.jsxs("article",{className:"card product-card h-100 cursor-pointer","aria-label":c,children:[e.jsx(A,{href:route("items.show",l),className:"text-decoration-none text-dark flex-grow-1",children:o&&e.jsx("img",{src:o,alt:c,loading:"lazy",className:"product-image",onClick:m=>m.stopPropagation()})}),e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs(A,{href:route("items.show",l),className:"text-decoration-none text-dark flex-grow-1",children:[e.jsx("h3",{children:c}),e.jsx("h6",{children:x}),e.jsx("p",{className:"text-muted",children:h}),e.jsxs("p",{className:"price fw-bold mt-auto",children:["EGP ",b]}),u&&e.jsxs("p",{className:"d-flex align-items-center",children:[e.jsx("span",{style:{display:"inline-block",width:16,height:16,borderRadius:"50%",backgroundColor:u,marginLeft:8,border:"1px solid #ccc"}}),e.jsxs("span",{className:"ms-2",children:[z(u).basic[0].name,", etc..."]})]}),t&&e.jsxs("p",{children:[t,", etc..."]})]}),C&&(I?e.jsx("div",{className:"alert alert-info mt-2 text-center cursor-text",children:"Already in cart"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",onClick:m=>m.stopPropagation(),children:[e.jsx("label",{className:"form-label fw-bold",children:"Quantity"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-2 qty-controls",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary qty-btn",onClick:()=>M(Math.max(1,g-1)),disabled:g<=1,children:"–"}),e.jsx("span",{className:"qty-display border rounded bg-light fw-bold",children:g}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary qty-btn",onClick:()=>M(g+1),children:"+"})]})]}),e.jsx("button",{className:"btn btn-success w-100",onClick:E,children:"Add to Cart"})]})),w&&(n||p)&&e.jsxs("div",{className:"flex gap-2 mt-2",onClick:m=>m.stopPropagation(),children:[n&&e.jsx("button",{className:"btn btn-primary flex-grow-1",onClick:n,children:"Edit"}),p&&e.jsx("button",{className:"btn btn-danger flex-grow-1",onClick:p,children:"Delete"})]}),r&&e.jsx("div",{className:"mt-2",onClick:m=>m.stopPropagation(),children:r})]})]}),e.jsx(q,{message:S,onClose:()=>s("")})]})},D=({onClose:l,onConfirm:c})=>{const[x,h]=a.useState(""),[o,b]=a.useState(""),[i,u]=a.useState(""),[d,t]=a.useState(""),n=()=>{if(!x||!o||!i||!d)return alert("All fields are required!");c({name:x,brand:o,description:i,price:d}),p()},p=()=>{h(""),b(""),u(""),t("")};return e.jsx("div",{className:j.modalOverlay,children:e.jsxs("div",{className:j.addModal,children:[e.jsxs("div",{className:j.modalHeader,children:[e.jsx("h3",{children:"Add Item"}),e.jsx("button",{className:`${j.closeBtn} fs-2`,onClick:l,children:"×"})]}),e.jsxs("div",{className:j.modalBody,children:[e.jsx("label",{children:"Item Name"}),e.jsx("input",{value:x,onChange:r=>h(r.target.value)}),e.jsx("label",{children:"Item Brand"}),e.jsx("input",{value:o,onChange:r=>b(r.target.value)}),e.jsx("label",{children:"Description"}),e.jsx("input",{value:i,onChange:r=>u(r.target.value)}),e.jsx("label",{children:"Price"}),e.jsx("input",{type:"number",min:"0",value:d,onChange:r=>t(r.target.value)})]}),e.jsxs("div",{className:j.modalFooter,children:[e.jsx("button",{className:"btn btn-success",onClick:n,children:"Add Item"}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:l,children:"Cancel"})]})]})})},V=()=>{const l=k(),c=l.props.category||{},x=l.props.products||[],[h,o]=a.useState(!1),[b,i]=a.useState(!1),[u,d]=a.useState(!1),[t,n]=a.useState(null),p=s=>{y.post(route("categories.items.store",c.category_id),{name:s.name,brand:s.brand,description:s.description,price:s.price},{preserveScroll:!0,onSuccess:()=>o(!1),onError:I=>console.log(I)})},r=s=>{t&&y.put(route("items.update",t.product_id),{name:s.name,brand:s.brand,description:s.description,price:s.price},{preserveScroll:!0,onSuccess:()=>{i(!1),n(null)}})},v=()=>{t&&y.delete(route("items.destroy",{item:t.id}),{preserveScroll:!0,onSuccess:()=>{d(!1),n(null)}})},f=()=>{i(!1),n(null)},N=()=>{d(!1),n(null)},{auth:C}=k().props,S=C.user?.user_type==="manager";return e.jsxs(e.Fragment,{children:[e.jsx(P,{title:"مركز وسائل الإيضاح"}),e.jsx(F,{page_name:"categories"}),e.jsxs(B,{children:[e.jsxs("h2",{className:"mt-6",children:[c.category_name?.toUpperCase()," Products"]}),S?e.jsx("div",{className:"action-btns mt-4 mb-8 flex gap-2.5",children:e.jsx("button",{className:"btn btn-success",onClick:()=>o(!0),children:"Add Item"})}):null,e.jsx("div",{className:"row",children:x.map(s=>e.jsx("div",{className:"col-6 col-md-4 col-lg-3 mb-4 mt-6",children:e.jsx(L,{id:s.id,title:s.title,brand:s.brand,description:s.description,price:s.price,color:s.color,color_id:s.color_id,size:s.size,size_id:s.size_id,image:s.image,onEdit:()=>{n(s),i(!0)},onDelete:()=>{n(s),d(!0)}},s.id)},s.id))}),h&&e.jsx(D,{onClose:()=>o(!1),onConfirm:p}),b&&t&&e.jsx(T,{currentItem:t,onClose:f,onConfirm:r}),u&&t&&e.jsx(H,{itemName:t.pr_name,onClose:N,onConfirm:v})]})]})};export{V as default};
